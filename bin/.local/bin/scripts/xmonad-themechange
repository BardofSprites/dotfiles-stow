#!/usr/bin/bash

themes=("Gruber Darker" "Modus Vivendi" "Ef Arbutus" "Ef Autumn")

selected_theme=$(printf "%s\n" "${themes[@]}" | dmenu -p "Select a theme:")

# Exit if no theme is selected
if [ -z "$selected_theme" ]; then
    exit 1
fi

apply_emacs_theme() {
    emacsclient -e "(bard/select-theme '$1)"
}

apply_generic_theme() {
    case $selected_theme in
        "Gruber Darker")
            BG_COLOR="#181818"
            FG_COLOR="#e4e4e4"
            XMONAD_MODULE="GruberDarker"
            apply_emacs_theme "gruber-darker"
            xrdb -merge ~/.Xresources.d/Xresources.gruber
            ;;
        "Modus Vivendi")
            BG_COLOR="#000000"
            FG_COLOR="#ffffff"
            XMONAD_MODULE="Modus.Vivendi"
            apply_emacs_theme "modus-vivendi"
            xrdb -merge ~/.Xresources.d/Xresources.vivendi
            ;;
        "Ef Arbutus")
            BG_COLOR="#ffead8"
            FG_COLOR="#393330"
            XMONAD_MODULE="Ef.Arbutus"
            apply_emacs_theme "ef-arbutus"
            xrdb -merge ~/.Xresources.d/Xresources.arbutus
            ;;
        "Ef Autumn")
            BG_COLOR="#0f0e06"
            FG_COLOR="#cfbcba"
            XMONAD_MODULE="Ef.Autumn"
            apply_emacs_theme "ef-autumn"
            ;;
            *)
            BG_COLOR="#181818"
            FG_COLOR="#e4e4e4"
            ;;
    esac

    # Update xmonad theme library
    sed -i "s/^import Colors\..*/import Colors.$XMONAD_MODULE/" ~/.config/xmonad/xmonad.hs

    # Update xmobar config file
    sed -i "s/bgColor = .*/bgColor = \"$BG_COLOR\"/" ~/.config/xmobar/xmobarrc
    sed -i "s/fgColor = .*/fgColor = \"$FG_COLOR\"/" ~/.config/xmobar/xmobarrc
    sed -i "s/borderColor = .*/borderColor = \"$BORDER_COLOR\"/" ~/.config/xmobar/xmobarrc
}

apply_generic_theme

# Recompile and restart xmonad
xmonad --recompile
xmonad --restart
