#!/bin/sh

# Music module script for dwmblocks

truncate() {
    echo "$1" | cut -c1-30
}

# Handle mouse events based on button clicks
case $BLOCK_BUTTON in
    1)  playerctl play-pause
        pkill -RTMIN+10 "${STATUSBAR:-dwmblocks}" ;;
    2)  emacs-launcher "music" & ;;
    3)  notify-send "ğŸµ Music Module
- Left click to play/pause.
- Middle click to open music player.
- Right click to show current track." ;;
    4)  playerctl previous
        pkill -RTMIN+10 "${STATUSBAR:-dwmblocks}" ;;
    5)  playerctl next
        pkill -RTMIN+10 "${STATUSBAR:-dwmblocks}" ;;
esac

# Get current track info
artist="$(playerctl metadata artist 2>/dev/null || echo "none")"
title="$(playerctl metadata title 2>/dev/null || echo "none")"

# Format full track string
current_track="$artist - $title"

playerstatus=$(playerctl status)

case "$playerstatus" in
    "Playing") icon="ğŸµ" ;;
    "Paused") icon="â¸ï¸" ;;
    "Stopped") icon="â¹ï¸" ;;
    *) icon="" ;;
esac

# Combine icon and track, then truncate to 15 chars
output="$icon $current_track"
echo "$(truncate "$output")"
